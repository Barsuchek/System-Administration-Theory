# Протокол OSPF
## Как работает маршрутизация?
Когда Вы включаете ролик на ютубе, Вы смотрите его благодаря тому, что информация с сервера ютуба попадает на Ваш компьютер.

Маршрутизатор отвечает за то, чтобы данные дошли из пункта "А" в пункт "Б".

Когда в маршрутизатор приходит пакет с Вашим запросом на просмотр видео, он отправляет их куда нужно.

### Откуда маршрутизатор знает, куда нужнно отправить пакет?
Для этого у маршрутизатора есть таблица маршрутизации, в которой все это описано.

Каждый роутер знает только то, куда нужно переслать пакет на следуюем шаге.

Роутер в сети ютуба не знает IP Вашего устройства, но благодаря маршрутизации видео-поток доходит куда надо.

### Как заполняется таблица маршрутизации?
* Статическая маршрутизация
	
	В случае статической маршрутизации администратор настраивает все вручную на каждом устройстве. Он указывает, через какой интерфейс нужно отправить определенные пакеты.
	
	Если в сети много маршрутизаторов, то статическая маршрутизация не логична.

* Динамическая маршрутизация
	
	Включить протокол автоматической маршрутизации можно в каждом роутере в сети, и таблица маршрутизации заполниться автоматически.
	
	В таком случае маршрутизаторы будут постоянно, самостоятельно обмениваться друг с другом информацией о сети, поддерживая таблицу маршрутизации в актуальном состоянии.
	
	Если вдруг что-то обновится, добавится или удалится, то все маршрутизаторы автоматически об этом узнают и обновят таблицы маршрутизации.

## Протокол динамической маршрутизации OSPF
Протокол маршрутизации OSPF(Open Shortest Path First) один из самых широкоиспользуемых среди динамических протоколов.

**OSPF** - это протокол динамической маршрутизации, отслеживающий состояние канала (Link-State) и использующий для нахождения кратчайшего пути до сетей алгоритм Дейкстры.

**Алгоритм Дейкстры** - это математический алгоритм, который позволяет найти самый короткий путь из одной вершины графа до другой.

Цель протокола OSPF - узнать все доступные для роутера маршруты. Для этого он узнает о каждом маршрутизаторе и подсетях о которых известно этим маршрутизаторам. В результате - каждый роутер имеет ту же информацию о сети, что и все остальные.

OSPF является протоколом внутридоменной маршрутизации (IGP). Эти протоколы используются для маршрутизации в пределах какой-то ограниченной сети. Например сети вашего провайдера.

К протоколам внутридоменной маршрутизации также относят: RIP, EIGRP, IS-IS.

Для маршрутизации между внутридоменных сетей используюстя протоколы междоменной маршрутизации (EGP). 

Самый известный протокол из междоменной маршрутизации - BGP.

### Как работает OSPF?
1. OSPF-маршрутизаторы должны распознать друг друга в сети, прежде чем они смогут обмениваться данными. 
	
	Для этого между ними должны установиться соседские отношения. Это делается путем отправки специальных "Hello" сообщений.

2. OSPF-роутер начинает постоянно отсылать их на все интерфейсы где он был включен, чтобы определить, есть ли за ними кто-то живой, и ждет ответного преветствия от соседа.
	
	Если ответное приветствие пришло, то можно работать дальше. А если нет, то признает соседа мертвым и не отправляет ему трафик.

3. Когда все соседние роутеры подружились, они начинают обмен сообщенями LSA(Link-State Advertisement).
	
	Эти сообщения содержат информацию о соседском роутере, состоянии каждого напрямую подключенного канала, специальную метрику "Cost".
	
	Полученные из LSA сведения роутер хранит в специальной базе LSDB, и каждый раутер должен иметь ту же информацию в этой базе, что и у остальных.

	Cost - это значение, которое присваивается каналу, на основании его пропускной способности. Она рассчитывается путем деления эталонной пропускной способности(по умолчанию 100 Мбит/с) на пропускную способность интерфейса (Сколько нужно заплатить, чтобы пройти по этому пути).

4. Маршрутизаторы рассылают свои LSA соседям.
	
	Соседи, получающие LSA, рассылают их другим соседям, и так далее, пока все маршрутизаторы в зоне не получат все LSA.

5. После получения LSA, маршрутизаторы строят у себя таблицу топологии (LSDB).
	
	Эта таблица в конечном итоге содержит всю информацию о топологии области.

6. Маршрутизаторы выполняют алгоритм Дейкстры (SPF), который рассчитывает оптимальный маршрут к каждой сети и создает дерево SPF.

7. После построения дерева SPF в таблице IP-маршрутизации предлагаются лучшие пути к каждой сети.
	
	Маршрут будет вставлен в таблицу маршрутизации если не существует маршрута к той же сети меньшей стоимостью(Cost). После этого можно считать, что OSPF "Сошелся".

OSPF выбирает для нас маршрут, который будет самым дешевым, а поскольку Cost рассчитывается из пропускной способности, то и самым бысрым.

Протокол работает постоянно, чтобы маршруты всегда были в актуальном состоянии.

При подключении нового устройства, данные в таблицах маршрутизаторов должны обновиться. OSPF продолжает отсылать "Hello" сообщения своим соседям, чтобы знать об их состоянии. А если не получит ответа, то поймет, что соседний роутер недоступен, обновит свои данные в таблице и сообщит это всем остальным роутерам в сети, чтобы они внесли изменения в своих таблицах.

Если бы все маршрутизаторы обменивлаись топологической информацией, это привело бы к большому количеству копий LSA, чтобы такого не произошло, в OSPF маршрутизатору назначаются две важные роли:
* Выделенный маршрутизатор (DR)
* Запасной выделенный маршрутизатор (BDR)

Назначение происходит автоматически, но администратор может настроить данные роли вручную.

В первую очередь обычный маршрутизатор в сети пытается подружиться с DR, и отправляет ему информацию об изменении в сети, а тот, в свою очередь отправляет ее всем остальным маршрутизаторам.

BDR нужен на случай, если DR не будет отвечать.