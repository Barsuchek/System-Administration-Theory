# DHCP

## Что такое DHCP?
Чтобы общаться между собой устройствам нужны IP адреса, но откуда они берутся?
1) Их самостоятельно раздает системный администратор на каждом устройстве(статический IP)
2) DHCP, который сам корректно раздаст правильные адреса в автоматическом режиме

DHCP работает по клиент-серверной модели, это значит, что есть DHCP сервер, который занимается раздачей адресов, и DHCP клиент, который запрашивает и получает адреса.

Сегодня DHCP запускаются не только на серверах, но и на роутерах.

На DHCP сервере задается диапазон адресов, которые он может раздать клиентам(пул).
Так же сервер отдает клиентам маску подсети, шлюз по умолчанию и может сообщить DNS сервера.

Например:
Вы купили новый компьютер, принесли домой и подключили в сеть, включаете его, настраиваете «автоматическое подключение адреса» в настройках сети и ПК шлет широковещательное сообщение DHCPDESCOVER, которое звучит как «я тут новичок, есть ли тут DHCP сервер, мне бы IP получить».

В адресе отправителя такого сообщения будут стоять нули(0.0.0.0), так как IP-адрес устройство еще не получило, а адрес получателя будет широковещательный(255.255.255.255).

Ваш роутер, на котором наверняка настроен DHCP, получает сообщение и смотрит, есть ли у него свободный адрес для нового ПК. Найдя для Вас IP он отправляет предложение с этим адресом - это сообщение называется DHCPOFFER.

В этом случае обратное сообщение шлется благодаря MAC-адресу.

ПК, получив DHCPOFFER в ответ шлет DHCPREQUEST, который означает что-то в форме «ладно, давай мне этот адрес». Это сообщение рассылаются всем в сети, на случай если у Вас несколько DHCP серверов, чтобы они были в курсе того, что этот IP теперь занят.
Сервер в ответ высылает сообщение DHCPACK, которое означает «ок, этот адрес твой» и записывает у себя в таблице сопоставление IP и MAC адресов компьютера и убирает этот IP из свободного пула.

Выданный адрес остается у компьютера не навсегда, диапазон раздаваемых адресов ограничен, поэтому они даются в аренду на время сетевой активности. 
Поэтому Ваш ПК в зависимости от настроек DHCP будет примерно раз в сутки отправлять сообщение DHCPREQUEST, чтобы продлить аренду, а сервер будет подтверждать продление сообщением DHCPACK.
Если запроса на продление не поступит, выделенный IP-адрес снова вернется в пул свободных адресов.

В сети есть устройства, адрес который меняться не должен(принтеры, серверы, роутеры). Для таких девайсов в DHCP реализован механизм статической резервации - как только такому устройству выдан IP-адрес, он закрепляется за ним на постоянной основе по MAC-адресу устройства.
